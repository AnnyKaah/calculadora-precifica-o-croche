<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Preço para Amigurumis</title>
    <link rel="icon" type="image/png" href="images/favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@400;500;600&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./assets/css/styles.css">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body>
    <div id="hero-page" class="hero">
        <div class="hero__content">
            <h1 class="hero__title">Amigurumi<span class="hero__title--accent">Preço</span></h1>
            <div class="hero__illustration">
                <div class="hero__bloom"></div>
                <img src="images/logo.png" alt="Logo AmigurumiPreço" class="hero__logo">
            </div>
            <p class="hero__subtitle">A ferramenta definitiva para precificar seu crochê com confiança e precisão.</p>
            <button id="enter-app-btn" class="btn btn--primary btn--large">Começar a Precificar</button>
        </div>
        <div class="hero__background">
            <div class="hero__blob hero__blob--1"></div>
            <div class="hero__blob hero__blob--2"></div>
            <div class="hero__blob hero__blob--3"></div>
            <div class="hero__blob hero__blob--4"></div>
            <div class="hero__blob hero__blob--5"></div>
        </div>
    </div>

    <div id="main-app" class="container-top-nav">
        <header class="app-header">
            <div class="app-header__content">
                <h1 class="app-header__title">Amigurumi<span class="app-header__title--accent">Preço</span></h1>
                <nav id="main-nav" class="app-header__nav">
                    <button class="nav-btn nav-btn--active" data-tab="calculator">
                        <i data-feather="tool" class="nav-btn__icon"></i>
                        <span>Calculadora</span>
                    </button>
                    <button class="nav-btn" data-tab="recipes">
                        <i data-feather="book-open" class="nav-btn__icon"></i>
                        <span>Receitas</span>
                    </button>
                    <button class="nav-btn" data-tab="history">
                        <i data-feather="archive" class="nav-btn__icon"></i>
                        <span>Histórico</span>
                    </button>
                </nav>
                <div class="app-header__actions">
                    <div class="settings">
                        <div class="form-group form-group--header">
                            <div class="label-with-tooltip">
                                <label for="baseSalary">Salário/Hora (R$)</label>
                                <div class="tooltip">
                                    <i data-feather="help-circle" class="tooltip__icon"></i>
                                    <span class="tooltip__text">Este é o valor que você cobra pela sua hora de trabalho. Use a calculadora para descobrir um valor sugerido.</span>
                                </div>
                            </div>
                            <input type="number" id="baseSalary" placeholder="30.00" step="0.01" value="30.00">
                            <a href="#" id="openSalaryHelper" class="salary-calculator-link">Não sabe o seu? Calcule aqui</a>
                        </div>
                    </div>

                    <button id="menu-toggle" class="menu-toggle">
                        <span></span><span></span><span></span>
                    </button>
                </div>
            </div>
        </header>

        <main class="main-content">
            <section id="calculator-tab" class="tab-pane tab-pane--active">
                <div class="page-header">
                    <h2>Calculadora de Preços</h2>
                    <p>Insira os detalhes da sua peça para calcular o preço final</p>
                </div>

                <div class="wizard-steps">
                    <div class="wizard-steps__item wizard-steps__item--active" data-step="1">
                        <div class="wizard-steps__counter">1</div>
                        <p class="wizard-steps__title">Informações</p>
                    </div>
                    <div class="wizard-steps__line"></div>
                    <div class="wizard-steps__item" data-step="3">
                        <div class="wizard-steps__counter">3</div>
                        <p class="wizard-steps__title">Materiais</p>
                    </div>
                    <div class="wizard-steps__line"></div>
                    <div class="wizard-steps__item" data-step="2">
                        <div class="wizard-steps__counter">2</div>
                        <p class="wizard-steps__title">Tempo</p>
                    </div>
                    <div class="wizard-steps__line"></div>
                    <div class="wizard-steps__item" data-step="4">
                        <div class="wizard-steps__counter">4</div>
                        <p class="wizard-steps__title">Preço Final</p>
                    </div>
                </div>

                <div id="calculator-form-steps">
                    <div class="form-step active-step" data-step-id="1">
                        <div class="card">
                            <h3 class="card__title"><i data-feather="clipboard"></i>Informações da Peça</h3>
                            <div class="form-group">
                                <label for="pieceName">Nome da Peça</label>
                                <div class="form-group__wrapper">
                                    <i data-feather="edit-3"></i>
                                    <input type="text" id="pieceName" placeholder="Ex: Urso Amigurumi">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="pieceType">Tipo de Peça</label>
                                <select id="pieceType">
                                    <option value="">Selecione um tipo</option>
                                    <option value="amigurumi">Amigurumi</option>
                                    <option value="manta">Manta</option>
                                    <option value="bolsa">Bolsa</option>
                                    <option value="acessorio">Acessório</option>
                                    <option value="outro">Outro</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-step" data-step-id="3">
                        <div class="card">
                            <h3 class="card__title"><i data-feather="disc"></i>Fios Utilizados</h3>
                            <p class="card__hint">Pese o novelo antes e depois do uso para calcular o custo exato.</p>
                            <div id="yarnsContainer"></div>
                            <button id="addYarnBtn" class="btn btn--secondary btn--small">+ Adicionar Fio</button>
                        </div>
                        <div class="card">
                            <h3 class="card__title"><i data-feather="scissors"></i>Aviamentos e Outros Materiais</h3>
                            <div id="materialsContainer"></div>
                            <div class="materials-subtotal">
                                <p>Subtotal dos materiais: <strong id="materialsSubtotalDisplay">R$ 0.00</strong></p>
                            </div>
                            <p class="card__hint">Ex: enchimento, olhos de segurança, botões, zíperes.</p>
                            <button id="addMaterialBtn" class="btn btn--secondary btn--small">+ Adicionar Material</button>
                            
                            <div class="waste-cost-container">
                                <div class="waste-cost-header">
                                    <button id="addWasteCostBtn" class="btn btn--secondary btn--small">+ Custo de Desperdício</button>
                                    <div class="tooltip">
                                        <i data-feather="help-circle" class="tooltip__icon"></i>
                                        <span class="tooltip__text">Inclua aqui custos de materiais que não são incorporados na peça, mas são consumidos no processo. Ex: cola, fita adesiva, embalagens, etiquetas, etc.</span>
                                    </div>
                                </div>
                                <p class="waste-cost-display">Custo de desperdício: <strong id="wasteCostDisplay">R$ 0.00</strong></p>
                            </div>
                        </div>
                    </div>

                    <div class="form-step" data-step-id="2">
                        <div class="card">
                            <h3 class="card__title"><i data-feather="clock"></i>Tempo de Produção</h3>
                            <div class="circular-timer">
                                <svg class="circular-timer__svg" viewBox="0 0 100 100">
                                    <circle class="circular-timer__background" cx="50" cy="50" r="45"></circle>
                                    <circle id="timer-progress" class="circular-timer__progress" cx="50" cy="50" r="45"></circle>
                                </svg>
                                <div id="timer-text" class="circular-timer__text">00:00:00</div>
                            </div>
                            <div class="circular-timer__controls">
                                <button id="startBtn" class="btn btn--start">
                                    <i data-feather="play"></i><span>Iniciar</span>
                                </button>
                                <button id="pauseBtn" class="btn btn--pause" disabled>
                                    <i data-feather="pause"></i><span>Pausar</span>
                                </button> 
                                <button id="resetBtn" class="btn btn--stop" style="display: none;">
                                    <i data-feather="rotate-ccw"></i><span>Resetar</span>
                                </button>
                            </div>
                            <div class="circular-timer__actions" style="margin-top: 1rem;">
                                <div class="rework-mode-container">
                                    <button id="reworkModeBtn" class="btn btn--rework">
                                        <i data-feather="alert-triangle"></i> Modo Retrabalho
                                    </button>
                                    <div class="tooltip">
                                        <i data-feather="help-circle" class="tooltip__icon"></i>
                                        <span class="tooltip__text">Use para cronometrar o tempo gasto corrigindo erros. Esse tempo será calculado como um custo separado no resumo final.</span>
                                    </div>
                                </div>
                                <button id="saveSessionBtn" class="btn btn--save-session">Salvar Sessão</button>
                            </div>
                            <p class="circular-timer__info">Tempo total da peça: <strong id="totalPieceTimeDisplay">0h 0m</strong></p>
                            <p class="card__hint"><strong>Dica:</strong> Após terminar, volte à etapa 'Materiais' para inserir o peso final dos fios.</p>
                        </div>

                        <div class="card">
                            <h3 class="card__title"><i data-feather="briefcase"></i>Custo de Mão de Obra</h3>
                            <div class="form-group form-group--inline">
                                <p class="form-group__label">Adicionar tempo manual:</p>
                                <div class="input-group--inline">
                                    <input type="number" id="manualHours" placeholder="0" min="0" class="form-group__input--small">
                                    <label for="manualHours">Horas</label>
                                </div>
                                <div class="input-group--inline">
                                    <input type="number" id="manualMinutes" placeholder="0" min="0" max="59" class="form-group__input--small">
                                    <label for="manualMinutes">Min</label>
                                </div>
                                <button id="addTimeBtn" class="btn btn--secondary btn--small">Adicionar</button>
                            </div>
                            <div class="labor-cost">
                                <p class="time-display-row">
    Tempo trabalhado: 
    <strong id="laborTimeDisplay">0h 0m</strong>
    <button id="editTimeBtn" class="btn-icon-small" title="Editar tempo total">
        <i data-feather="edit-2"></i>
    </button>
</p>
                                <p>Salário/hora: <strong id="laborRateDisplay">R$ 30.00</strong></p>
                                <p>Custo de mão de obra: <strong id="laborCostDisplay">R$ 0.00</strong></p>
                            </div>
                        </div>
                    </div>

                    <div class="form-step" data-step-id="4">
                        <div class="card card--summary">
                            <h3 class="card__title">Resumo de Custos</h3>
                            
                            <div class="summary-item">
                                <span class="summary-item__label">Custo de Fios:</span>
                                <span class="summary-item__value" id="yarnCostDisplay">R$ 0.00</span>
                            </div>

                            <div class="summary-item">
                                <span class="summary-item__label">Custo de Outros Materiais:</span>
                                <span class="summary-item__value" id="materialsCostDisplay">R$ 0.00</span>
                            </div>

                            <div class="summary-item">
                                <span class="summary-item__label">Custo de Mão de Obra:</span>
                                <span class="summary-item__value" id="laborCostSummary">R$ 0.00</span>
                            </div>

                            <div class="summary-item">
                                <span class="summary-item__label summary-item__label--rework">Custo de Retrabalho:</span>
                                <span class="summary-item__value" id="reworkCostDisplay">R$ 0.00</span>
                            </div>

                            <div class="summary-item">
                                <span class="summary-item__label">Custo Total:</span>
                                <span class="summary-item__value" id="totalCostDisplay">R$ 0.00</span>
                            </div>

                            <div class="chart-container">
                                <h4 class="chart-title">Distribuição de Custos</h4>
                                <canvas id="costDistributionChart"></canvas>
                            </div>

                            <hr class="divider">

                            <div class="price-settings-block">
                                <h4 class="settings-title">Ajustes Finais</h4>
                                <div class="settings-inputs">
                                    <div class="form-group">
                                        <div class="label-with-tooltip">
                                            <label for="indirectCosts">Custos Indiretos (%)</label>
                                            <div class="tooltip">
                                                <i data-feather="help-circle" class="tooltip__icon"></i>
                                                <span class="tooltip__text">Uma porcentagem sobre o custo total para cobrir despesas como luz, água, internet, marketing, etc.</span>
                                            </div>
                                        </div>
                                        <div class="form-group__wrapper">
                                            <i data-feather="percent"></i>
                                            <input type="number" id="indirectCosts" placeholder="15" value="15" min="0" step="1">
                                        </div>
                                    </div>
        
                                    <div class="form-group">
                                        <div class="label-with-tooltip">
                                            <label for="profitMargin">Margem de Lucro (%)</label>
                                            <div class="tooltip">
                                                <i data-feather="help-circle" class="tooltip__icon"></i>
                                                <span class="tooltip__text">A porcentagem que você deseja ganhar sobre o custo total da peça (incluindo custos indiretos).</span>
                                            </div>
                                        </div>
                                        <div class="form-group__wrapper">
                                            <i data-feather="percent"></i>
                                            <input type="number" id="profitMargin" placeholder="30" value="30" min="0" step="1">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="summary-final">
                                <p class="summary-final__label">Preço Final Sugerido</p>
                                <p class="summary-final__value" id="finalPriceDisplay"><span class="summary-final__currency">R$</span> 0.00</p>
                            </div>

                            <button id="savePieceBtn" class="btn btn--primary btn--full">Salvar Peça</button>
                        </div>
                    </div>
                </div>

                <div class="fixed-action-footer">
                    <button id="prev-step-btn" class="btn btn--secondary">Voltar</button>
                    <button id="next-step-btn" class="btn btn--primary">Avançar</button>
                </div>
            </section>

            <section id="recipes-tab" class="tab-pane">
                <div class="page-header">
                    <h2>Minhas Receitas</h2>
                    <p>Gerencie suas receitas de fios e materiais</p>
                </div>

                <div class="recipes-container">
                    <button id="addRecipeBtn" class="btn btn--primary">+ Nova Receita</button>
                    <div id="recipesGrid" class="recipes-grid"></div>
                </div>
            </section>

            <section id="history-tab" class="tab-pane">
                <div class="page-header">
                    <h2>Histórico de Peças</h2>
                    <p>Acompanhe todas as peças que você precificou</p>
                </div>

                <div class="history-filters">
                    <div class="form-group form-group--search">
                        <i data-feather="search"></i>
                        <input type="text" id="historySearchInput" placeholder="Buscar por nome ou tipo...">
                    </div>
                    <div class="form-group">
                        <label for="historySortSelect">Ordenar por:</label>
                        <select id="historySortSelect">
                            <option value="date_desc">Mais Recentes</option>
                            <option value="date_asc">Mais Antigos</option>
                            <option value="name_asc">Nome (A-Z)</option>
                            <option value="name_desc">Nome (Z-A)</option>
                        </select>
                    </div>
                </div>

                <div id="historyContainer" class="history-container"></div>
            </section>
        </main>
    </div>

    <div id="yarnModal" class="modal">
        <div class="modal__content">
            <div class="modal__header">
                <h3 id="yarnModalTitle">Adicionar Fio</h3>
                <button class="modal__close">&times;</button>
            </div>
            <div class="modal__body">
                <div class="form-group">
                    <label for="yarnName">Nome do Fio</label>
                    <input type="text" id="yarnName" placeholder="Ex: Fio Bege">
                </div>
                <div class="form-group">
                    <label for="yarnInitialWeight">Peso Inicial (g)</label>
                    <input type="number" id="yarnInitialWeight" placeholder="100" step="0.1">
                </div>
                <div class="form-group">
                    <label for="yarnFinalWeight">Peso Final (g)</label>
                    <input type="number" id="yarnFinalWeight" placeholder="50" step="0.1">
                </div>
                <div class="form-group">
                    <div class="price-helper">
                        <p class="price-helper__title">Não sabe o preço por grama? Calcule aqui:</p>
                        <div class="helper-inputs">
                            <div class="form-group">
                                <label for="skeinPrice">Preço do novelo (R$)</label>
                                <input type="number" id="skeinPrice" placeholder="20.00">
                            </div>
                            <div class="form-group">
                                <label for="skeinWeight">Peso do novelo (g)</label>
                                <input type="number" id="skeinWeight" placeholder="100">
                            </div>
                        </div>
                    </div>

                    <label for="yarnPricePerGram">Preço por Grama (R$)</label>
                    <input type="number" id="yarnPricePerGram" placeholder="0.20" step="0.001">
                </div>
            </div>
            <div class="modal__footer">
                <button id="cancelYarnBtn" class="btn btn--secondary">Cancelar</button>
                <button id="confirmYarnBtn" class="btn btn--primary">Adicionar</button>
            </div>
        </div>
    </div>

    <div id="recipeModal" class="modal"> 
        <div class="modal__content">
            <div class="modal__header"> 
                <h3>Criar Nova Receita</h3>
                <button class="modal__close">&times;</button>
            </div>
            <div class="modal__body">
                <div class="form-group">
                    <label for="recipeName">Nome da Receita</label>
                    <input type="text" id="recipeName" placeholder="Ex: Receita de Urso Padrão">
                </div>
                <div class="form-group">
                    <label for="recipeDescription">Descrição Curta</label>
                    <input type="text" id="recipeDescription" placeholder="Ex: Urso com macacão azul">
                </div>
                <div class="form-group">
                    <label for="recipeSalePrice">Preço de Venda Sugerido (R$)</label>
                    <input type="number" id="recipeSalePrice" placeholder="150.00">
                </div>
                <hr class="divider">
                <div id="recipe-materials-list"></div>
                <button id="addYarnToRecipeBtn" class="btn btn--secondary btn--small">+ Adicionar Fio</button>
                <button id="addMaterialToRecipeBtn" class="btn btn--secondary btn--small">+ Adicionar Aviamento</button>
                <div class="form-group" style="margin-top: 20px;">
                    <label for="recipeSteps">Passo a Passo (Opcional)</label>
                    <textarea id="recipeSteps" placeholder="Anote aqui o passo a passo, links ou informações importantes." rows="4"></textarea>
                </div>
            </div>
            <div class="modal__footer">
                <button id="cancelRecipeBtn" class="btn btn--secondary">Cancelar</button>
                <button id="confirmRecipeBtn" class="btn btn--primary">Salvar Receita</button>
            </div>
        </div>
    </div>

    <div id="materialModal" class="modal">
        <div class="modal__content">
            <div class="modal__header"> 
                <h3 id="materialModalTitle">Adicionar Material</h3>
                <button class="modal__close">&times;</button>
            </div>
            <div class="modal__body">
                <div class="form-group">
                    <label for="materialName">Nome do Material</label>
                    <input type="text" id="materialName" placeholder="Ex: Olhos de segurança (par)">
                </div>
                <div class="form-group">
                    <label for="materialQuantity">Quantidade</label>
                    <input type="number" id="materialQuantity" placeholder="1" value="1" step="1">
                </div>
                <div class="form-group">
                    <label for="materialPrice">Preço Unitário (R$)</label>
                    <input type="number" id="materialPrice" placeholder="2.50" step="0.01">
                </div>
            </div>
            <div class="modal__footer">
                <button id="cancelMaterialBtn" class="btn btn--secondary">Cancelar</button>
                <button id="confirmMaterialBtn" class="btn btn--primary">Adicionar</button>
            </div>
        </div>
    </div>

    <div id="salaryHelperModal" class="modal">
        <div class="modal__content">
            <div class="modal__header">
                <h3>Calculadora de Salário/Hora</h3>
                <button class="modal__close">&times;</button>
            </div>
            <div class="modal__body">
                <p>Responda as perguntas abaixo para descobrir uma sugestão de valor para sua hora de trabalho.</p>
                <div class="form-group">
                    <label for="desiredSalary">Qual seu salário mensal desejado? (R$)</label>
                    <input type="number" id="desiredSalary" placeholder="2000">
                </div>
                <div class="form-group">
                    <label for="hoursPerDay">Quantas horas você trabalha por dia?</label>
                    <input type="number" id="hoursPerDay" placeholder="6">
                </div>
                <div class="form-group">
                    <label for="daysPerWeek">Quantos dias você trabalha por semana?</label>
                    <input type="number" id="daysPerWeek" placeholder="5">
                </div>
                <div id="salaryResultDisplay" class="salary-helper__result" style="display: none;">
                    Seu salário/hora sugerido é: <strong>R$ 0.00</strong>
                </div>
            </div>
            <div class="modal__footer">
                <button id="applySalaryBtn" class="btn btn--primary" disabled>Aplicar Valor</button>
            </div>
        </div>
    </div>

    <div id="saveOptionsModal" class="modal">
        <div class="modal__content modal__content--small">
            <div class="modal__header">
                <h3>Salvar Precificação</h3>
                <button class="modal__close">&times;</button>
            </div>
            <div class="modal__body">
                <p>Como você gostaria de salvar os dados desta peça?</p>
                <div class="save-options">
                    <button id="saveAsPdfBtn" class="btn btn--primary"><i data-feather="file-text"></i> Salvar como PDF</button>
                    <button id="saveAsCsvBtn" class="btn btn--secondary"><i data-feather="grid"></i> Salvar como CSV</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast-container" class="toast-container"></div>

    <div id="sr-announcer" class="sr-only" aria-live="polite" aria-atomic="true"></div>

    <div id="wasteModal" class="modal">
        <div class="modal__content modal__content--small">
            <div class="modal__header">
                <h3>Custo de Desperdício</h3>
                <button class="modal__close">&times;</button>
            </div>
            <div class="modal__body">
                <p style="margin-bottom: 15px; font-size: 0.9rem; color: #666;">
                    Insira o valor estimado de gastos extras (cola, embalagem, etiquetas).
                </p>
                <div class="form-group">
                    <label for="wasteCostInput">Valor (R$)</label>
                    <div class="form-group__wrapper">
                        <i data-feather="dollar-sign"></i>
                        <input type="number" id="wasteCostInput" placeholder="0.00" step="0.01">
                    </div>
                </div>
            </div>
            <div class="modal__footer">
                <button class="btn btn--secondary modal-close-btn">Cancelar</button>
                <button id="confirmWasteBtn" class="btn btn--primary">Salvar Valor</button>
            </div>
        </div>
    </div>
<div id="editTimeModal" class="modal">
    <div class="modal__content modal__content--small">
        <div class="modal__header">
            <h3>Editar Tempo Total</h3>
            <button class="modal__close">&times;</button>
        </div>
        <div class="modal__body">
            <p style="margin-bottom: 15px; font-size: 0.9rem; color: #666;">
                Corrija o tempo total de produção manualmente.
            </p>
            <div class="form-group form-group--inline">
                <div class="input-group--inline">
                    <input type="number" id="editTimeHours" placeholder="0" min="0" class="form-group__input--small">
                    <label for="editTimeHours">Horas</label>
                </div>
                <div class="input-group--inline">
                    <input type="number" id="editTimeMinutes" placeholder="0" min="0" max="59" class="form-group__input--small">
                    <label for="editTimeMinutes">Min</label>
                </div>
            </div>
        </div>
        <div class="modal__footer">
            <button class="btn btn--secondary modal-close-btn">Cancelar</button>
            <button id="confirmEditTimeBtn" class="btn btn--primary">Salvar Correção</button>
        </div>
    </div>
</div>

</body>
<script src="./assets/js/app.js" type="module"></script>
<script>
    feather.replace(); // Ativa a biblioteca de ícones
</script>
</html>